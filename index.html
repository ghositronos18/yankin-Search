<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Yakin Search ‚Äì Doƒüu AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">

<style>
/* ---------- YAKIN-SEARCH UI ---------- */
:root{
  --bg:#0b0e14;
  --card:#111827;
  --border:#374151;
  --text:#e8eaed;
  --link:#8ab4f8;
  --url:#34d399;
  --muted:#9ca3af;
  --accent:#8b5cf6;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:var(--bg);
  color:var(--text);
}
.logo-image{
  position:absolute;
  top:12px;
  left:12px;
  width:40px;
  height:40px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid var(--accent);
  cursor:pointer;
}
/* Yakin-style top bar */
.yakin-bar{
  display:flex;
  align-items:center;
  gap:12px;
  margin:12px 16px;
}
.yakin-logo{
  font-size:1.6rem;
  font-weight:500;
  color:var(--text);
}
.search-bar{
  flex:1;
  max-width:650px;
  position:relative;
}
.search-input{
  width:100%;
  padding:10px 44px 10px 16px;
  border:1px solid var(--border);
  border-radius:24px;
  background:var(--card);
  color:var(--text);
  outline:none;
}
.search-input:focus{
  border-color:var(--accent);
}
.search-bar-icons{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  display:flex;
  gap:8px;
}
.icon-btn{
  background:none;
  border:none;
  color:var(--muted);
  cursor:pointer;
  font-size:1.1rem;
}
/* Yakin-style result cards */
.result-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px 18px;
  margin:10px 16px;
  transition:background .2s;
}
.result-card:hover{
  background:#1a2332;
}
.result-title{
  font-size:1.1rem;
  color:var(--link);
  text-decoration:none;
  display:block;
  margin-bottom:4px;
}
.result-title:visited{
  color:#c58af9;
}
.result-url{
  color:var(--url);
  font-size:.9rem;
  margin-bottom:4px;
}
.result-snippet{
  color:var(--text);
  font-size:.95rem;
  line-height:1.5;
}
.result-favicon{
  width:16px;
  height:16px;
  vertical-align:middle;
  margin-right:6px;
}
/* Tabs (All, Images, Videos, News, Maps) */
.tabs{
  display:flex;
  gap:6px;
  margin:0 16px 12px;
  border-bottom:1px solid var(--border);
}
.tab{
  padding:8px 14px;
  cursor:pointer;
  border-bottom:2px solid transparent;
  color:var(--muted);
  font-size:.9rem;
}
.tab.active{
  color:var(--text);
  border-color:var(--accent);
}
/* Pagination */
.pagination{
  display:flex;
  gap:6px;
  justify-content:center;
  margin:20px 0;
}
.page-btn{
  padding:6px 12px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  border-radius:6px;
  cursor:pointer;
}
.page-btn:hover{
  border-color:var(--accent);
}
/* Doƒüu-AI chat bubbles */
.dogu-ai-response{
  border-left:4px solid var(--accent);
  padding-left:12px;
  margin:10px 0;
}
.dogu-ai-header{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:8px;
}
.dogu-ai-icon{
  width:24px;
  height:24px;
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:.9rem;
}
.voice-status{
  position:fixed;
  top:20px;
  right:20px;
  background:#111827;
  padding:12px 16px;
  border-radius:12px;
  display:none;
  align-items:center;
  gap:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  z-index:1000;
}
.dogu-ai-status{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.voice-dot{
  width:10px;
  height:10px;
  background:#ef4444;
  border-radius:50%;
  animation:pulse 1.5s infinite;
}
.dogu-ai-dot{
  background:#8b5cf6;
}
.voice-text{
  font-size:.9rem;
}
.loading-spinner{
  border:3px solid #1f2937;
  border-top:3px solid #2563eb;
  border-radius:50%;
  width:24px;
  height:24px;
  animation:spin 1s linear infinite;
  margin:10px auto;
}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.6;}}

/* Music, file, etc. keep existing styles */
.music-options{
  display:flex;
  gap:10px;
  margin-top:10px;
  flex-wrap:wrap;
}
.music-btn{
  padding:8px 16px;
  background:var(--border);
  border-radius:20px;
  font-size:.9rem;
  cursor:pointer;
  border:none;
  color:var(--text);
}
.music-btn:hover{
  background:#4b5563;
}
.service-modal{ /* kept from old file */
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
}
.modal-content{
  background:var(--card);
  border-radius:16px;
  padding:20px;
  max-width:500px;
  width:90%;
  max-height:80vh;
  overflow-y:auto;
}
.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}
.modal-close{
  background:none;
  border:none;
  color:var(--muted);
  font-size:1.5rem;
  cursor:pointer;
}
.file-upload-area{
  border:2px dashed var(--border);
  border-radius:12px;
  padding:30px 20px;
  text-align:center;
  margin-top:15px;
  cursor:pointer;
  transition:border-color .2s;
}
.file-upload-area:hover{
  border-color:#3b82f6;
}
.file-upload-area.dragover{
  border-color:#10b981;
  background:#064e3b20;
}
.upload-icon{
  font-size:2rem;
  margin-bottom:10px;
}
#fileList{
  margin-top:15px;
  max-height:200px;
  overflow-y:auto;
}
.file-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 12px;
  background:#1f2937;
  border-radius:8px;
  margin-bottom:6px;
}
.file-name{
  flex:1;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.file-size{
  font-size:.8rem;
  color:var(--muted);
  margin-left:10px;
}
.file-actions{
  display:flex;
  gap:6px;
}
.file-action-btn{
  background:none;
  border:none;
  color:var(--muted);
  cursor:pointer;
  font-size:.9rem;
  padding:2px 6px;
}
.file-action-btn:hover{
  color:#3b82f6;
}
.file-services{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:10px;
  margin-top:10px;
}
.file-service{
  background:#1f2937;
  border-radius:12px;
  padding:12px;
  text-align:center;
  cursor:pointer;
  transition:background .2s,transform .2s;
}
.file-service:hover{
  background:#374151;
  transform:translateY(-2px);
}
.file-service i{
  font-size:1.5rem;
  margin-bottom:8px;
  display:block;
}
.file-service-name{
  font-size:.9rem;
  font-weight:500;
}
.file-service-desc{
  font-size:.75rem;
  color:var(--muted);
  margin-top:4px;
}
/* Responsive tweaks */
@media(max-width:768px){
  .yakin-bar{flex-direction:column;align-items:stretch;}
  .search-bar{max-width:100%;}
  .tabs{overflow-x:auto;}
}
</style>
</head>

<body>
<!-- LOGO IMAGE TOP-LEFT -->
<img id="logoImage" class="logo-image" src="üöÄ" alt="Yakin" title="Yakin Search">

<!-- YAKIN-STYLE TOP BAR -->
<div class="yakin-bar">
  <div class="yakin-logo">üöÄ Yakin Search</div>
  <div class="search-bar">
    <input id="q" class="search-input" placeholder="Search or ask Doƒüu AI...">
    <div class="search-bar-icons">
      <button class="search-btn text-search" title="Search">üîç</button>
      <button class="search-btn dogu-ai" title="Doƒüu AI">‚ú®</button>
      <button class="search-btn voice-search" title="Voice Search">üé§</button>
      <button class="search-btn file-search" title="File Services">üìÅ</button>
    </div>
  </div>
</div>

<!-- YAKIN-STYLE TABS -->
<div class="tabs">
  <div class="tab active" data-type="web">All</div>
  <div class="tab" data-type="images">Images</div>
  <div class="tab" data-type="videos">Videos</div>
  <div class="tab" data-type="news">News</div>
  <div class="tab" data-type="maps">Maps</div>
</div>

<!-- VOICE STATUS -->
<div class="voice-status" id="voiceStatus">
  <div class="voice-dot"></div>
  <div class="voice-text">Listening... Speak now</div>
</div>
<div class="voice-status dogu-ai-status" id="doguAiStatus" style="display:none">
  <div class="voice-dot dogu-ai-dot"></div>
  <div class="voice-text">Doƒüu AI is listening...</div>
</div>


<div id="results"></div>

<div class="service-modal" id="fileModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 style="margin:0">File Services</h3>
      <button class="modal-close" onclick="closeFileModal()">√ó</button>
    </div>
    <div class="file-upload-area" id="uploadArea">
      <div class="upload-icon">üìÅ</div>
      <p>Drag & drop files here or click to browse</p>
      <input type="file" id="fileInput" multiple style="display:none">
      <p class="note">Supports images, documents, audio, and video files</p>
    </div>
    <div id="fileList"></div>
    <div class="file-services">
      <div class="file-service" onclick="searchOnService('googleDrive')">
        <i>üìÅ</i>
        <div class="file-service-name">Google Drive</div>
        <div class="file-service-desc">Cloud storage</div>
      </div>
      <div class="file-service" onclick="searchOnService('dropbox')">
        <i>üì¶</i>
        <div class="file-service-name">Dropbox</div>
        <div class="file-service-desc">File sharing</div>
      </div>
      <div class="file-service" onclick="searchOnService('onedrive')">
        <i>‚òÅÔ∏è</i>
        <div class="file-service-name">OneDrive</div>
        <div class="file-service-desc">Microsoft cloud</div>
      </div>
      <div class="file-service" onclick="searchOnService('icloud')">
        <i>üçé</i>
        <div class="file-service-name">iCloud</div>
        <div class="file-service-desc">Apple cloud</div>
      </div>
      <div class="file-service" onclick="openService('wetransfer')">
        <i>üì§</i>
        <div class="file-service-name">WeTransfer</div>
        <div class="file-service-desc">File transfer</div>
      </div>
      <div class="file-service" onclick="openService('figma')">
        <i>üé®</i>
        <div class="file-service-name">Figma</div>
        <div class="file-service-desc">Design files</div>
      </div>
      <div class="file-service" onclick="openService('github')">
        <i>üíª</i>
        <div class="file-service-name">GitHub</div>
        <div class="file-service-desc">Code files</div>
      </div>
      <div class="file-service" onclick="openService('notion')">
        <i>üìù</i>
        <div class="file-service-name">Notion</div>
        <div class="file-service-desc">Documents</div>
      </div>
    </div>
  </div>
</div>

<script>

const GOOGLE_API_KEY = 'AIzaSyBb1j15Q1SpYtrorpt8J8dp09YBgresNLU';   
const GOOGLE_CX      = '720402e63a7b34fce'; 
const GEMINI_KEY     = 'AIzaSyAOsM-CRIL8bHkFjfzRUJAi8P1oSlLZ4YE';

let doguAiMode = false;
let currentTab = 'web'; 
let currentPage = 1;
let lastQuery = '';


const input = document.getElementById('q');
const results = document.getElementById('results');
const voiceBtn = document.querySelector('.voice-search');
const doguAiBtn = document.querySelector('.dogu-ai');
const fileBtn = document.querySelector('.file-search');
const voiceStatus = document.getElementById('voiceStatus');
const doguAiStatus = document.getElementById('doguAiStatus');
const fileModal = document.getElementById('fileModal');
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const fileList = document.getElementById('fileList');
const tabs = document.querySelectorAll('.tab');


async function yakinSearch(rawQuery, type = 'web', page = 1) {
  lastQuery = rawQuery;
  currentTab = type;
  currentPage = page;
  results.innerHTML = '<div class="loading-spinner"></div>';

  const start = (page - 1) * 10 + 1;
  const url = `https://www.googleapis.com/customsearch/v1?q=${encodeURIComponent(rawQuery)}&key=${GOOGLE_API_KEY}&cx=${GOOGLE_CX}&start=${start}&num=10`;

  try {
    const res = await fetch(url);
    const data = await res.json();

    // Handle Google error
    if (data.error) {
      results.innerHTML = `<div class="result-card">Google API: ${data.error.message}</div>`;
      return;
    }

    const items = data.items || [];
    let html = '';
    items.forEach(r => {
      html += `
        <div class="result-card">
          <a class="result-title" href="${r.link}" target="_blank" rel="noreferrer">
            <img class="result-favicon" src="https://www.google.com/s2/favicons?domain=${new URL(r.link).hostname}">
            ${r.title}
          </a>
          <div class="result-url">${r.htmlTitle ? r.htmlTitle.replace(/<.*?>/g, '') : r.link}</div>
          <div class="result-snippet">${r.snippet || ''}</div>
        </div>`;
    });

    if (!html) html = '<div class="result-card">No results found.</div>';

    // pagination
    html += `
      <div class="pagination">
        <button class="page-btn" onclick="yakinSearch('${rawQuery}','${type}',${page-1})" ${page===1?'disabled':''}>‚Äπ Prev</button>
        <span style="color:var(--muted);font-size:.9rem;">Page ${page}</span>
        <button class="page-btn" onclick="yakinSearch('${rawQuery}','${type}',${page+1})">Next ‚Ä∫</button>
      </div>`;

    results.innerHTML = html;
  } catch (e) {
    console.error(e);
    inlineWebSearch(rawQuery); // fallback
  }
}


tabs.forEach(t => t.addEventListener('click', () => {
  tabs.forEach(x => x.classList.remove('active'));
  t.classList.add('active');
  if (lastQuery) yakinSearch(lastQuery, t.dataset.type, 1);
}));


async function doguAIQuery(prompt){
  if (!GEMINI_KEY || GEMINI_KEY === 'YOUR_GEMINI_2.5_FLASH_FREE_KEY_HERE') return 'Doƒüu AI offline (no key).';
  try {
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_KEY}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ contents: [{ parts: [{ text: `You are Doƒüu AI, a helpful voice assistant. Reply conversationally to: "${prompt}". Keep it short.` }] }] })
    });
    const data = await res.json();
    return data?.candidates?.[0]?.content?.parts?.[0]?.text || 'I‚Äôm here‚Äîwhat else can I do?';
  } catch (e) {
    return 'Connection trouble.';
  }
}

function speakDoƒüuAIResponse(text){
  if ('speechSynthesis' in window) {
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 1; u.pitch = 1; u.volume = 1;
    speechSynthesis.speak(u);
  }
}

async function handleDoƒüuAIQuery(query){
  const q = query.toLowerCase().trim();
  if (q.includes('hey doƒüai') || q.includes('hello doƒüai') || q.includes('okay doƒüai')) {
    const response = await doguAIQuery(q.replace(/hey doƒüai|hello doƒüai|okay doƒüai/gi, '').trim());
    speakDoƒüuAIResponse(response);
    return `
      <div class="result-card">
        <div class="dogu-ai-header">
          <div class="dogu-ai-icon">‚ú®</div>
          <b>Doƒüu AI</b>
        </div>
        <div class="result-snippet">${response}</div>
        <div class="note" style="color:var(--muted);font-size:.8rem;">Speaking response‚Ä¶</div>
      </div>`;
  }
  if (q.includes('weather')) return inlineWebSearch('weather');
  if (q.includes('joke') || q.includes('funny')) {
    const jokes = [
      "Why don't scientists trust atoms? Because they make up everything!",
      "Why did the scarecrow win an award? Because he was outstanding in his field!",
      "What do you call a fake noodle? An impasta!"
    ];
    const joke = jokes[Math.floor(Math.random() * jokes.length)];
    speakDoƒüuAIResponse(joke);
    return `
      <div class="result-card">
        <div class="dogu-ai-header">
          <div class="dogu-ai-icon">‚ú®</div>
          <b>Doƒüu AI</b>
        </div>
        <div class="result-snippet">${joke}</div>
      </div>`;
  }
  if (q.includes('calculate')) {
    try {
      const expr = q.replace(/calculate|what is|how much is/gi, '').trim();
      const ans = eval(expr.replace(/[^-()\d/*+.]/g, ''));
      speakDoƒüuAIResponse(`The result is ${ans}`);
      return `
        <div class="result-card">
          <div class="dogu-ai-header">
            <div class="dogu-ai-icon">‚ú®</div>
            <b>Doƒüu AI</b>
          </div>
          <div class="result-snippet">üßÆ ${expr} = ${ans}</div>
        </div>`;
    } catch (e) {}
  }
  const response = await doguAIQuery(query);
  speakDoƒüuAIResponse(response);
  return `
    <div class="result-card">
      <div class="dogu-ai-header">
        <div class="dogu-ai-icon">‚ú®</div>
        <b>Doƒüu AI</b>
      </div>
      <div class="result-snippet">${response}</div>
    </div>`;
}


let isListening = false;
let recognition = null;
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-US';
  recognition.onstart = () => {
    isListening = true;
    document.querySelector('.voice-search').classList.add('listening');
    voiceStatus.style.display = 'flex';
  };
  recognition.onresult = (e) => {
    const transcript = e.results[0][0].transcript;
    input.value = transcript;
    handle(transcript);
  };
  recognition.onerror = () => {
    voiceStatus.style.display = 'none';
  };
  recognition.onend = () => {
    isListening = false;
    document.querySelector('.voice-search').classList.remove('listening');
    voiceStatus.style.display = 'none';
  };
  document.querySelector('.voice-search').addEventListener('click', () => {
    if (isListening) recognition.stop(); else recognition.start();
  });
} else {
  document.querySelector('.voice-search').style.display = 'none';
}


function openFileModal(){
  fileModal.style.display = 'flex';
  renderFileList();
}
function closeFileModal(){
  fileModal.style.display = 'none';
}
function searchOnService(service){
  const query = input.value.trim();
  if (query) {
    switch(service){
      case 'googleDrive': yakinSearch('site:drive.google.com ' + query, 'web', 1); break;
      case 'dropbox': yakinSearch('site:dropbox.com ' + query, 'web', 1); break;
      case 'onedrive': yakinSearch('site:onedrive.live.com ' + query, 'web', 1); break;
      case 'icloud': yakinSearch('site:icloud.com ' + query, 'web', 1); break;
    }
  } else {
    openService(service);
  }
  closeFileModal();
}
function openService(service){
  const urls = {
    wetransfer: 'https://wetransfer.com',
    figma: 'https://figma.com',
    github: 'https://github.com',
    notion: 'https://notion.so',
    googledrive: 'https://drive.google.com',
    dropbox: 'https://dropbox.com',
    onedrive: 'https://onedrive.live.com',
    icloud: 'https://icloud.com'
  };
  window.open(urls[service] || `https://${service}.com`, '_blank');
  closeFileModal();
}
uploadArea.addEventListener('click', () => fileInput.click());
uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.classList.add('dragover');
});
uploadArea.addEventListener('dragleave', () => {
  uploadArea.classList.remove('dragover');
});
uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  handleFiles(Array.from(e.dataTransfer.files));
});
fileInput.addEventListener('change', (e) => {
  handleFiles(Array.from(e.target.files));
  fileInput.value = '';
});
function handleFiles(files){
  files.forEach(file => {
    uploadedFiles.unshift({
      name: file.name,
      size: file.size,
      type: file.type,
      lastModified: file.lastModified,
      preview: URL.createObjectURL(file)
    });
    if (uploadedFiles.length > 10) uploadedFiles.pop();
    localStorage.setItem("uploadedFiles", JSON.stringify(uploadedFiles));
  });
  renderFileList();
  results.innerHTML = `<div class="result-card"><b>üìÅ Files Uploaded</b><p>Successfully uploaded ${files.length} file(s).</p></div>`;
}
function renderFileList(){
  fileList.innerHTML = uploadedFiles.length > 0 ?
    uploadedFiles.slice(0, 5).map(file => `
      <div class="file-item">
        <span class="file-name">üìÑ ${file.name}</span>
        <span class="file-size">${formatFileSize(file.size)}</span>
        <span class="file-actions">
          <button class="file-action-btn" onclick="openFile('${file.name}')" title="Open">üîç</button>
          <button class="file-action-btn" onclick="removeFile('${file.name}')" title="Remove">üóëÔ∏è</button>
        </span>
      </div>`).join('') :
    '<p class="note" style="text-align:center">No files uploaded yet</p>';
}
function openFile(filename){
  const file = uploadedFiles.find(f => f.name === filename);
  if (file && file.preview) window.open(file.preview, '_blank');
}
function removeFile(filename){
  uploadedFiles = uploadedFiles.filter(f => f.name !== filename);
  localStorage.setItem("uploadedFiles", JSON.stringify(uploadedFiles));
  renderFileList();
}
function formatFileSize(bytes){
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function parseMusicQuery(query){
  const patterns = [
    /play\s+"(.+?)"\s+by\s+(.+)/i,
    /play\s+(.+?)\s+by\s+(.+)/i,
    /play\s+(.+)\s+on\s+(.+)/i,
    /play\s+(.+)/i
  ];
  for (const pattern of patterns) {
    const match = query.match(pattern);
    if (match) {
      return {
        song: match[1].trim(),
        artist: match[2] ? match[2].trim() : '',
        fullQuery: `${match[1].trim()} ${match[2] ? match[2].trim() : ''}`.trim()
      };
    }
  }
  return { song: query.replace(/^play\s+/i, '').trim(), artist: '', fullQuery: query.replace(/^play\s+/i, '').trim() };
}
async function autoPlayYouTube(query) {
  const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}&key=AIzaSyCKFVBOrnw-SlRVyT8bb3zfwex4dvHSf3w&maxResults=1`);
  const data = await res.json();
  if (!data.items || !data.items.length) return alert("No video found");
  embedPlayer(`https://www.youtube.com/embed/${data.items[0].id.videoId}?autoplay=1`);
}
function autoPlayYouTubeMusic(query) {
  window.open(`https://music.youtube.com/search?q=${encodeURIComponent(query)}`, "_blank");
}
function autoPlaySpotify(query) {
  window.open(`https://open.spotify.com/search/${encodeURIComponent(query)}`, "_blank");
}
function autoPlaySoundCloud(query) {
  window.open(`https://soundcloud.com/search?q=${encodeURIComponent(query)}`, "_blank");
}
function embedPlayer(src, msg) {
  const box = document.getElementById('embedBox');
  if (!box) return;
  if (msg) {
    box.innerHTML = `<p class="note">${msg}</p>`;
    return;
  }
  box.innerHTML = `<iframe src="${src}" width="100%" height="300" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
}

async function handle(query){
  const q = query.trim();
  if (!q) return;
  addToHistory(q);

  if (doguAiMode || q.toLowerCase().includes('hey doƒüai') || q.toLowerCase().includes('okay doƒüai')) {
    results.innerHTML = '<div class="loading-spinner"></div>';
    const html = await handleDoƒüuAIQuery(q);
    results.innerHTML = html;
    return;
  }

  if (q.toLowerCase().startsWith('play ')) {
    const musicData = parseMusicQuery(q);
    results.innerHTML = `
      <div class="result-card">
        <b>üéµ Play: ${musicData.fullQuery}</b>
        ${musicData.artist ? `<p class="note">Artist: ${musicData.artist}</p>` : ''}
        <div class="music-options">
          <button class="music-btn" onclick="autoPlayYouTube('${musicData.fullQuery.replace(/'/g, "\\'")}')">YouTube</button>
          <button class="music-btn" onclick="autoPlayYouTubeMusic('${musicData.fullQuery.replace(/'/g, "\\'")}')">YouTube Music</button>
          <button class="music-btn" onclick="autoPlaySpotify('${musicData.fullQuery.replace(/'/g, "\\'")}')">Spotify</button>
          <button class="music-btn" onclick="autoPlaySoundCloud('${musicData.fullQuery.replace(/'/g, "\\'")}')">SoundCloud</button>
        </div>
        <p class="note" style="margin-top:10px;">Auto-playing on YouTube‚Ä¶</p>
        <div id="embedBox" style="margin-top:10px;"></div>
      </div>`;
    setTimeout(() => autoPlayYouTube(musicData.fullQuery), 600);
    return;
  }

  const lower = q.toLowerCase();
  if (lower.startsWith('find ') || lower.startsWith('search ') || lower.includes('file') || lower.includes('document')) {
    if (lower.includes('drive') || lower.includes('google')) {
      yakinSearch('site:drive.google.com ' + q, 'web', 1);
      return;
    }
    if (lower.includes('dropbox')) {
      yakinSearch('site:dropbox.com ' + q, 'web', 1);
      return;
    }
    openFileModal();
    return;
  }
  if (lower.startsWith('open ')) {
    const site = q.replace('open ', '').replace(/\s+/g, '');
    window.open(`https://${site}.com`, '_blank');
    results.innerHTML = `<div class="result-card">Opening ${site}.com</div>`;
    return;
  }
  if (lower.includes('gmail') || lower.includes('email')) {
    window.open('https://mail.google.com', '_blank');
    results.innerHTML = `<div class="result-card">Opening Gmail</div>`;
    return;
  }
  if (lower.includes('youtube') && !lower.includes('youtube music')) {
    window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`, '_blank');
    results.innerHTML = `<div class="result-card">Opening YouTube for: ${q}</div>`;
    return;
  }
  if (lower.includes('spotify')) {
    window.open(`https://open.spotify.com/search/${encodeURIComponent(q)}`, '_blank');
    results.innerHTML = `<div class="result-card">Opening Spotify for: ${q}</div>`;
    return;
  }
  // Default: yakin search on active tab
  yakinSearch(q, currentTab, 1);
}

let searchHistory = JSON.parse(localStorage.getItem("searchHistory")) || [];
let uploadedFiles = JSON.parse(localStorage.getItem("uploadedFiles")) || [];
function addToHistory(q){
  if (!q.trim()) return;
  searchHistory = searchHistory.filter(item => item.toLowerCase() !== q.toLowerCase());
  searchHistory.unshift(q);
  searchHistory = searchHistory.slice(0, 10);
  localStorage.setItem("searchHistory", JSON.stringify(searchHistory));
}
function showHistory(){
  if (searchHistory.length === 0 && uploadedFiles.length === 0) return '';
  let html = '';
  if (uploadedFiles.length > 0) {
    html += `
      <div class="result-card">
        <b>Recent Files</b>
        ${uploadedFiles.slice(0, 3).map(f => `
          <div class="file-item" onclick="openFile('${f.name}')">
            <span class="file-name">üìÑ ${f.name}</span>
            <span class="file-size">${formatFileSize(f.size)}</span>
          </div>`).join('')}
      </div>`;
  }
  if (searchHistory.length > 0) {
    html += `
      <div class="result-card">
        <b>Recent Searches</b>
        ${searchHistory.map(item => `
          <div class="history-item" onclick="input.value='${item.replace(/'/g, "\\'")}'; handle('${item.replace(/'/g, "\\'")}')">
            ${item}
          </div>`).join('')}
      </div>`;
  }
  return html;
}


input.addEventListener('keydown', e => {
  if (e.key === 'Enter') handle(input.value);
  if (e.key === '/') {
    e.preventDefault();
    input.focus();
    input.select();
  }
  if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'l') {
    e.preventDefault();
    input.focus();
    input.select();
  }
  if (e.key === 'Escape') {
    if (isListening && recognition) recognition.stop();
    input.value = '';
    input.blur();
  }
  if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'f') {
    e.preventDefault();
    openFileModal();
  }
  if ((e.ctrlKey || e.metaKey) && e.key === ' ') {
    e.preventDefault();
    // toggle Doƒüu-AI mode
    doguAiMode = !doguAiMode;
    document.querySelector('.dogu-ai').classList.toggle('active', doguAiMode);
    input.placeholder = doguAiMode ? 'Ask Doƒüu AI anything‚Ä¶' : 'Search or ask Doƒüu AI‚Ä¶';
  }
});

/* INITIALIZE */
results.innerHTML = showHistory();
input.focus();
if (searchHistory.length === 0 && uploadedFiles.length === 0) {
  setTimeout(() => {
    results.innerHTML = `
      <div class="result-card">
        <div class="dogu-ai-header">
          <div class="dogu-ai-icon">‚ú®</div>
          <b>Welcome to Yakin Search ‚Äì Doƒüu AI Edition</b>
        </div>
        <p>Try searching the web, images, videos, news, or maps. Say ‚ÄúHey Doƒüu AI‚Äù for AI, ‚Äúplay ‚Ä¶‚Äù for music, or ‚Äúopen gmail‚Äù to launch sites.</p>
      </div>`;
  }, 500);
}
</script>
</body>
</html>


